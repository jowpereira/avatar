<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avatar Chat - IA Conversacional</title>
    <link href="./css/styles.css" rel="stylesheet">
    <script src="https://aka.ms/csspeech/jsbrowserpackageraw"></script>
    <script src="./js/basic.js"></script>
</head>
<body>
<div class="app-container">
  <header class="app-header">
    <h1>🤖 Avatar Chat - IA Conversacional</h1>
    <div class="header-controls">
      <button id="modeToggle" class="mode-toggle" onclick="window.toggleMode()">
        <span id="modeText">💬 Chat Mode</span>
      </button>
      <button id="toggleConfig" class="config-toggle" onclick="window.toggleConfiguration()">⚙️ Configurações</button>
    </div>
  </header>

<div id="configuration" class="config-panel">
  <div class="config-section">
    <h3>🔧 Azure Speech Resource</h3>
    <div class="config-row">
      <div class="form-group">
        <label for="region">Region:</label>
        <select id="region">
          <option value="westus2">West US 2</option>
          <option value="westeurope">West Europe</option>
          <option value="southeastasia">Southeast Asia</option>
          <option value="southcentralus">South Central US</option>
          <option value="northeurope">North Europe</option>
          <option value="swedencentral">Sweden Central</option>
          <option value="eastus2">East US 2</option>
        </select>
      </div>
      <div class="form-group">
        <label for="APIKey">API Key:</label>
        <input id="APIKey" type="password" placeholder="Cole sua API Key aqui" />
      </div>
    </div>
    <div class="checkbox-group">
      <input type="checkbox" id="enablePrivateEndpoint" onchange="window.updatePrivateEndpoint()">
      <label for="enablePrivateEndpoint">Enable Private Endpoint</label>
    </div>
    <div id="showPrivateEndpointCheckBox" class="form-group" hidden>
      <label for="privateEndpoint">Private Endpoint:</label>
      <input id="privateEndpoint" type="text" placeholder="https://{your custom name}.cognitiveservices.azure.com/" />
    </div>
  </div>

  <div class="config-section">
    <h3>🎤 TTS Configuration</h3>
    <div class="form-group">
      <label for="ttsVoice">TTS Voice:</label>
      <input id="ttsVoice" type="text" value="en-US-AvaMultilingualNeural" />
    </div>
    <div class="checkbox-group">
      <input type="checkbox" id="hybridGesturesMode">
      <label for="hybridGesturesMode">Modo Gestos AO VIVO (via batch)</label>
    </div>
    <div class="form-group">
      <label for="customVoiceEndpointId">Custom Voice Deployment ID:</label>
      <input id="customVoiceEndpointId" type="text" placeholder="Endpoint ID opcional" />
    </div>
  </div>

  <div class="config-section">
    <h3>👤 Avatar Configuration</h3>
    <div class="config-row">
      <div class="form-group">
        <label for="talkingAvatarCharacter">Avatar Character:</label>
        <input id="talkingAvatarCharacter" type="text" value="lisa" />
      </div>
      <div class="form-group">
        <label for="talkingAvatarStyle">Avatar Style:</label>
        <input id="talkingAvatarStyle" type="text" value="casual-sitting" />
      </div>
    </div>
    <div class="config-row">
      <div class="form-group">
        <label for="backgroundColor">Background Color:</label>
        <input id="backgroundColor" type="text" value="#FFFFFFFF" />
      </div>
      <div class="form-group">
        <label for="backgroundImageUrl">Background Image (URL):</label>
        <input id="backgroundImageUrl" type="text" placeholder="https://www.example.com/1920-1080-image.jpg" />
      </div>
    </div>
    <div class="checkbox-group">
      <input type="checkbox" id="customizedAvatar" onchange="window.updateCustomAvatarBox()">
      <label for="customizedAvatar">Custom Avatar</label>
      <input type="checkbox" id="useBuiltInVoice" disabled>
      <label for="useBuiltInVoice">Use Built-In Voice</label>
    </div>
    <div class="checkbox-group">
      <input type="checkbox" id="transparentBackground" onchange="window.updataTransparentBackground()">
      <label for="transparentBackground">Transparent Background</label>
      <input type="checkbox" id="videoCrop">
      <label for="videoCrop">Video Crop</label>
      <input type="checkbox" id="showSubtitles">
      <label for="showSubtitles">Show Subtitles</label>
    </div>
  </div>

  <div class="config-section">
    <h3>🎯 Controls</h3>
    <div class="button-group">
      <button id="startSession" onclick="window.startSession()" class="btn btn-primary">🚀 Start Session</button>
      <button id="speak" onclick="window.speak()" disabled class="btn btn-secondary">🗣️ Speak</button>
      <button id="stopSpeaking" onclick="window.stopSpeaking()" disabled class="btn btn-warning">⏹️ Stop Speaking</button>
  <button id="copySSML" onclick="window.copyLastSsmlToClipboard()" class="btn btn-small">📋 Copiar SSML</button>
  <button id="generateBatch" onclick="window.generateBatchClip()" class="btn btn-secondary">🎬 Gerar clipe com gestos</button>
      <button id="stopSession" onclick="window.stopSession()" disabled class="btn btn-danger">🛑 Stop Session</button>
    </div>
  </div>
</div>

<div class="main-content">
  <div class="chat-container">
    <div class="video-section">
      <h3 id="videoLabel">🎬 Avatar Video</h3>
      <div id="videoContainer" class="video-wrapper">
        <div id="overlayArea" class="video-overlay" hidden>
          <p id="overlayText">Live Video</p>
        </div>
        <div id="remoteVideo"></div>
  <video id="batchVideo" class="batch-video" controls hidden></video>
        <div id="subtitles" class="subtitles" hidden></div>
        <canvas id="canvas" class="video-canvas" hidden></canvas>
        <canvas id="tmpCanvas" class="video-canvas" hidden></canvas>
      </div>
    </div>
    
    <div class="chat-section" id="chatSection">
      <div class="chat-header">
        <h3>💬 Conversa com o Avatar</h3>
        <button id="clearChat" onclick="window.clearChatHistory()" class="btn btn-small">🗑️ Limpar</button>
      </div>
      <div id="chatHistory" class="chat-history"></div>
      <div class="chat-input-section">
        <div class="input-group">
          <input id="userPrompt" type="text" placeholder="Digite sua mensagem aqui..." 
                 onkeydown="if(event.key==='Enter'){event.preventDefault();window.askAI()}" />
          <button id="askAI" onclick="window.askAI()" class="btn btn-primary">📨 Enviar</button>
        </div>
      </div>
    </div>

    <!-- NEW: Teaching Mode Section -->
    <div class="teaching-section" id="teachingSection" style="display: none;">
      <div class="teaching-header">
        <h3>🎓 Modo Ensino</h3>
        <div class="teaching-controls">
          <button id="startTeaching" onclick="window.startTeaching()" class="btn btn-success">▶️ Iniciar Curso</button>
          <button id="pauseTeaching" onclick="window.pauseTeaching()" disabled class="btn btn-warning">⏸️ Pausar</button>
          <button id="nextLesson" onclick="window.nextLesson()" disabled class="btn btn-primary">⏭️ Próximo Tópico</button>
          <button id="stopTeaching" onclick="window.stopTeaching()" disabled class="btn btn-danger">⏹️ Finalizar</button>
        </div>
      </div>
      
      <div class="lesson-progress" id="lessonProgress" style="display: none;">
        <div class="progress-info">
          <span id="currentTopic">Carregando...</span>
          <span id="progressText">0/0</span>
        </div>
        <div class="progress-bar">
          <div id="progressFill" class="progress-fill"></div>
        </div>
      </div>
      
      <div id="lessonContent" class="lesson-content" style="display: none;"></div>
      
      
    </div>
  </div>
</div>

<!-- Hidden elements for compatibility -->
<textarea id="spokenText" hidden> </textarea>

<div class="logs-section" id="logsSection">
  <div class="logs-header">
    <h3>📝 System Logs</h3>
    <button onclick="window.toggleLogs()" class="btn btn-small">👁️ Toggle</button>
  </div>
  <div id="logging" class="logs-content"></div>
</div>

</div> <!-- app-container -->
